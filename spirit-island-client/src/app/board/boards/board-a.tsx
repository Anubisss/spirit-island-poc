import { useMemo } from 'react';

import Land from '../land';
import { PlayerLandPresence } from '../player-land-presence';
import { Board, BoardProps, TerrainType } from '../types';

const MAX_DISTANCE = 1;

interface PresencePositions {
  [playerId: number]: {
    [landNumber: number]: { x: number; y: number };
  };
}

interface MergedPresences {
  [landNumber: number]: PlayerLandPresence[];
}

const lands = [
  {
    number: 1,
    terrainType: TerrainType.Mountain,
    isCoastal: true,
    adjacentLandNumbers: [2, 4, 5, 6],
  },
  {
    number: 2,
    terrainType: TerrainType.Wetland,
    isCoastal: true,
    adjacentLandNumbers: [1, 3, 4],
  },
  {
    number: 3,
    terrainType: TerrainType.Jungle,
    isCoastal: true,
    adjacentLandNumbers: [2, 4],
  },
  {
    number: 4,
    terrainType: TerrainType.Sands,
    adjacentLandNumbers: [1, 2, 3, 5],
  },
  {
    number: 5,
    terrainType: TerrainType.Wetland,
    adjacentLandNumbers: [1, 4, 6, 7, 8],
  },
  {
    number: 6,
    terrainType: TerrainType.Mountain,
    adjacentLandNumbers: [1, 5, 8],
  },
  { number: 7, terrainType: TerrainType.Sands, adjacentLandNumbers: [5, 8] },
  {
    number: 8,
    terrainType: TerrainType.Jungle,
    adjacentLandNumbers: [5, 6, 7],
  },
];

const presencePositions: PresencePositions = {
  1: {
    1: { x: 850, y: 350 },
    2: { x: 530, y: 600 },
    3: { x: 420, y: 900 },
    4: { x: 790, y: 800 },
    5: { x: 1120, y: 650 },
    6: { x: 1150, y: 330 },
    7: { x: 1350, y: 800 },
    8: { x: 1520, y: 300 },
  },
  2: {
    1: { x: 900, y: 230 },
    2: { x: 600, y: 500 },
    3: { x: 550, y: 870 },
    4: { x: 900, y: 750 },
    5: { x: 1100, y: 780 },
    6: { x: 1230, y: 220 },
    7: { x: 1350, y: 680 },
    8: { x: 1520, y: 180 },
  },
};

const calcOtherPlayerId = (playerId: number) => {
  return playerId === 1 ? 2 : 1;
};

const MapComponent = ({
  landDistances,
  presences,
  currentClientId,
  playerId,
  onLandAddPresence,
}: BoardProps) => {
  const mergedPresences: MergedPresences = useMemo(() => {
    const ret: MergedPresences = {};

    for (const land of lands) {
      ret[land.number] = [];
      if (presences[land.number] !== undefined) {
        for (const clientId in presences[land.number]) {
          const presencePlayerId =
            clientId === currentClientId
              ? playerId
              : calcOtherPlayerId(playerId);

          const { x, y } = presencePositions[presencePlayerId][land.number];

          ret[land.number].push({
            count: presences[land.number][clientId],
            pos: {
              x,
              y,
            },
            fillColor: presencePlayerId === 1 ? '#0074cc' : '#ffd700',
            textColor: presencePlayerId === 1 ? '#ffffff' : '#000000',
          });
        }
      }
    }

    return ret;
  }, [presences, currentClientId, playerId]);

  return (
    <svg width="1000" viewBox="0 0 1775.2183 1034.0719">
      <g transform="translate(-93.80024,-18.180298)">
        <defs>
          <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="1" dy="2" stdDeviation="2" floodColor="#000000" />
          </filter>
        </defs>
        <Land
          landNumber={3}
          fill="#27963c"
          d="m 94.95939,888.84349 c 8.9139,-61.34023 14.73154,-122.68046 30.0803,-184.02069 l 122.68046,5.8981 c 28.18338,15.00399 52.06983,7.80721 75.49566,-1.76943 l 48.76829,23.00351 c 22.53155,8.67102 45.17552,16.66748 68.57305,20.14258 40.36196,5.02834 87.5076,11.337 130.56145,6.69444 133.77235,46.71049 85.5139,133.29865 23.72915,205.37311 -43.64607,6.78559 -94.21655,-16.71336 -115.69151,51.41609 -78.34163,12.9091 -138.30427,-25.22412 -188.96978,-74.83444 -0.12389,-25.69309 -4.42315,-49.29849 -44.82555,-54.85232 z"
          presences={mergedPresences[3]}
          canAddPresence={!landDistances || landDistances[3] <= MAX_DISTANCE}
          onLandAddPresence={onLandAddPresence}
        />
        <Land
          landNumber={4}
          fill="#d5b615"
          d="m 594.80798,964.42468 c 67.71325,-0.70648 142.10465,32.01241 201.81756,-2.70275 26.49667,-78.97883 84.48111,-36.50483 135.76694,-19.86834 10.78536,-62.69903 25.11425,-124.37231 70.95832,-176.92277 8.6335,-30.5294 18.4907,-48.18613 17.6526,-101.96426 -67.01268,-36.56905 -113.76603,-83.96354 -148.90471,-138.71314 -26.2834,27.73428 -30.51559,40.0915 -39.38137,57.55199 -43.34585,28.06921 -85.61262,-17.39899 -129.75678,-21.70764 -85.40834,188.80822 -98.30643,176.05248 -132.34768,198.76348 144.01184,47.51019 74.33653,140.89041 24.19512,205.56343 z"
          presences={mergedPresences[4]}
          canAddPresence={!landDistances || landDistances[4] <= MAX_DISTANCE}
          onLandAddPresence={onLandAddPresence}
        />
        <path
          style={{
            fill: '#24aae1',
            stroke: '#021e0b',
            strokeWidth: '1',
          }}
          d="m 125.02349,704.92213 c 27.63308,1.49443 49.87458,4.75012 74.77665,3.72442 9.56616,-0.39402 20.37279,0.45852 30.7182,0.9726 6.05269,0.30077 10.94423,1.67829 16.43772,1.18599 0.81103,-0.0727 -2.39494,-0.13767 2.1199,1.34416 2.99626,0.98342 5.3014,2.17848 7.82839,3.17513 2.30282,0.90824 6.06115,2.42637 10.54634,3.01987 3.01455,0.3989 6.71848,-0.26976 9.17366,0.61856 19.52062,-0.47756 51.08951,-3.33243 71.89167,-34.00811 -15.65209,-34.04724 -26.69328,-69.45679 -9.20174,-113.29646 l 31.63099,-21.27903 c 82.49466,-68.98981 109.31199,-167.09354 156.43672,-290.6233 8.23721,-6.27293 16.92696,2.38832 25.66536,12.65476 21.45843,3.24237 36.88299,-10.1084 50.24193,-29.13964 4.79572,-16.6021 6.21052,-32.52803 15.52794,-50.03447 21.09771,-7.91538 43.50268,-14.04813 70.1633,-14.37773 11.64505,-8.01675 17.28946,-29.88114 22.42925,-52.91002 10.75769,1.18127 21.15159,3.93895 33.35631,-1.15022 C 765.81135,109.0711 750.0234,73.510277 732.11369,36.806972 675.42341,58.001936 619.23103,79.89445 563.0293,85.120848 c -9.73232,-0.656301 -18.47074,-3.300423 -27.20923,-5.944368 -49.87499,59.73046 -70.7311,108.35759 -114.84032,151.44221 -10.75077,9.97251 -21.58545,8.10228 -34.88601,4.41704 -9.48363,6.2056 -12.30413,16.85062 -10.17521,31.23971 2.03721,40.78383 -3.35616,80.02211 -15.52322,118.66808 -16.52741,23.9383 -40.4777,34.85231 -65.91355,36.40861 -26.09346,37.97732 -42.48709,89.56909 -65.60257,134.20075 -15.53482,3.03682 -35.50075,3.3042 -43.69411,10.92943 -14.71953,11.28682 -22.07125,28.2084 -30.83103,42.97174 -14.25728,31.37465 -21.57633,63.44312 -29.33056,95.46808 z"
        />
        <Land
          landNumber={2}
          fill="#66cbb6"
          d="m 324.10068,708.26334 c 29.10614,15.65339 58.69602,30.64164 92.82306,39.3913 50.48741,9.14833 101.17396,15.11049 152.49503,10.92036 42.24821,-16.16598 58.1666,-49.88518 76.0525,-82.29271 21.22258,-38.39146 41.87251,-76.95911 57.7219,-117.00386 15.00096,-48.02101 31.93873,-95.83814 31.59104,-145.47479 -3.37676,-17.37508 -5.41697,-34.90741 -15.60051,-51.4817 11.3776,-24.49112 19.96049,-48.61101 23.81061,-73.93851 3.87237,-14.82766 5.33979,-35.41047 0.90089,-51.25002 -8.11051,-28.94113 -23.9097,-51.69441 -53.57245,-58.11751 -18.99177,-0.78463 -42.02397,2.91035 -71.76237,14.04046 -7.09796,15.62665 -12.32259,32.18997 -15.2105,49.92165 -13.07249,19.33946 -28.95629,31.12354 -49.92164,29.25096 -7.52193,-6.26899 -11.55311,-18.02345 -25.35084,-14.43047 l -58.50193,152.88503 -70.59232,113.10373 -58.89194,47.19156 c -18.57889,40.28587 -7.90072,77.38005 8.19027,113.88375 z"
          presences={mergedPresences[2]}
          canAddPresence={!landDistances || landDistances[2] <= MAX_DISTANCE}
          onLandAddPresence={onLandAddPresence}
        />
        <Land
          landNumber={1}
          fill="#918f90"
          d="m 732.17614,36.794527 c 6.28271,-2.519656 14.62318,-5.1895 20.64259,-7.186748 22.603,-7.4997 47.60841,-13.273399 155.23939,-8.945594 21.93737,-0.505522 44.15825,-2.302633 62.16623,15.092379 19.87696,48.025366 43.52235,79.469506 72.40745,87.859206 6.6695,8.86913 4.6795,24.4734 4.3843,38.75954 -7.5641,18.09502 -26.6475,34.46212 -50.46278,50.11946 -5.86932,27.51882 -8.40081,50.64578 -6.5224,67.97022 -23.56984,63.63097 -9.35832,102.34233 4.4627,141.31125 L 871.0668,525.34579 c -11.58598,12.16692 -18.69983,21.36082 -23.48034,28.83125 -1.96835,3.07589 -5.23115,8.14727 -7.57934,11.79646 -2.11732,3.29041 -2.67088,6.6854 -7.40879,15.26207 -7.20309,5.37802 -14.82137,8.47251 -22.85116,9.30369 -16.99872,2.16311 -33.99744,-3.85927 -50.99616,-10.90871 -23.40934,-11.73712 -36.94029,-16.30102 -55.72692,-20.04101 7.10482,-23.00161 11.34697,-34.03206 25.72903,-87.4658 2.85162,-17.22517 6.15409,-28.66397 5.57313,-61.8352 -2.51863,-14.46198 -4.72481,-28.72513 -14.86168,-48.03508 12.61834,-31.12713 25.93727,-60.97821 25.74255,-115.44341 -6.42604,-28.52842 -13.89672,-56.55541 -54.93514,-68.46988 9.51956,-17.9049 19.18412,-35.82591 20.43481,-52.81205 h 31.58107 c 15.75457,-7.23965 18.12148,-28.977935 -10.11172,-88.733593 z"
          presences={mergedPresences[1]}
          canAddPresence={!landDistances || landDistances[1] <= MAX_DISTANCE}
          onLandAddPresence={onLandAddPresence}
        />
        <Land
          landNumber={5}
          fill="#66cbb6"
          d="m 932.37707,941.85292 c 27.61952,8.36716 52.04456,26.81377 73.90273,47.3535 10.3517,15.31628 17.3165,6.53298 20.1847,39.76018 1.3574,14.4309 13.6781,17.1913 26.9029,18.9893 9.2358,-54.93467 17.9855,-101.1544 56.2727,-148.58291 24.66,-32.73841 41.8452,-62.56807 73.7916,-98.62305 17.4094,-15.15814 30.7859,-35.0742 39.1971,-46.36193 21.939,-43.5405 29.0059,-91.86111 36.6115,-136.1688 29.0028,-30.17598 48.1212,-52.79323 88.317,-91.52856 27.9029,-26.10638 63.1864,-50.98265 104.3877,-74.87263 -44.5245,-21.79701 -116.4749,-54.60698 -161.8741,-91.48454 -37.1922,30.01469 -71.4541,61.98551 -112.0823,89.60164 -19.5125,21.82081 -45.6584,29.97786 -68.7267,37.57489 -21.0689,3.00209 -41.8577,3.0912 -61.6613,-7.06537 -25.1048,-11.46147 -39.2974,-33.37902 -53.23122,-58.61038 -37.02885,30.87174 -76.98495,64.48521 -122.11828,102.60832 10.2954,14.48046 3.84737,10.33974 42.07103,55.8806 25.67406,25.51403 48.48842,45.44481 68.0844,59.09212 12.54929,8.84626 25.38587,15.96871 38.21717,23.123 1.715,23.61019 -1.0899,41.74888 -4.8173,58.77097 -3.1633,14.23778 -7.6084,28.47555 -11.8826,42.71333 -17.93405,18.97165 -29.70555,41.96237 -41.1076,65.19402 -10.11718,19.98303 -12.65969,39.42002 -21.17364,62.94596 -3.38254,18.32766 -5.6492,32.07177 -9.26549,49.69034 z"
          presences={mergedPresences[5]}
          canAddPresence={!landDistances || landDistances[5] <= MAX_DISTANCE}
          onLandAddPresence={onLandAddPresence}
        />
        <Land
          landNumber={6}
          fill="#918f90"
          d="m 1043.7111,124.38798 c 45.5024,22.87347 62.0698,25.90849 83.4622,31.29763 19.9165,2.37066 29.2615,0.7087 43.8726,-6.65218 8.2558,-13.89536 14.2007,-28.37041 21.825,-34.74898 7.8354,-6.96491 23.7011,-13.25122 51.3202,-18.544269 45.2527,1.065486 89.8283,4.087289 136.0457,12.548269 13.7473,24.63403 4.9939,45.27655 2.8207,66.37269 -11.6994,40.24129 -22.7904,69.53012 -34.0697,102.20911 -18.6612,35.47564 -34.0995,59.44017 -58.8694,83.3618 l -46.4534,39.16655 c -24.129,19.99165 -44.1019,35.79026 -64.8994,50.47603 -10.71,13.63102 -28.4513,25.24171 -66.1094,36.58899 -11.3681,2.78588 -23.5723,4.31765 -37.9511,2.58758 -14.9094,-3.5731 -29.8149,-7.15804 -42.2637,-18.11301 -17.6982,-13.28221 -28.0109,-30.3691 -37.51979,-47.87009 -7.71103,-23.82099 -17.28161,-47.43537 -18.113,-72.02077 1.27077,-13.48539 -0.3068,-21.59056 4.31262,-41.40116 2.3479,-11.86006 5.45304,-20.31259 8.62524,-28.4633 0.50609,-23.15015 1.06963,-46.30472 6.90019,-69.86445 16.37104,-13.995 30.66424,-16.56116 50.02644,-47.00757 2.1096,-20.99699 0.3774,-28.78562 -2.962,-39.92287 z"
          presences={mergedPresences[6]}
          canAddPresence={!landDistances || landDistances[6] <= MAX_DISTANCE}
          onLandAddPresence={onLandAddPresence}
        />
        <Land
          landNumber={8}
          fill="#27963c"
          d="m 1379.3026,108.09614 c 13.864,2.87661 29.0778,4.68014 43.4297,7.43022 23.8042,-4.58696 49.8539,-8.62064 60.7986,-23.493908 14.8947,-17.035355 9.2593,-24.359976 21.6676,-32.872292 24.1287,-6.586675 43.1477,-8.807452 90.7135,12.369497 24.2736,12.383352 32.8636,9.725974 69.4178,43.086953 26.2823,25.83078 29.3746,42.26398 29.6621,56.18495 3.0027,8.59454 19.5798,12.65137 31.0734,17.60698 45.7636,10.02069 93.9453,3.11506 141.5235,0.43412 -14.112,41.02122 -25.8032,80.96742 -62.0793,121.98801 -19.5052,37.5993 -39.7344,21.89184 -65.1857,16.63153 -60.8545,5.11581 -90.3868,39.02999 -127.7976,74.98532 -17.9393,17.0227 -31.5341,35.55094 -15.829,64.23261 7.7628,14.18129 13.5511,28.36258 4.3412,42.54387 -21.1199,2.17073 -42.0152,3.45826 -58.1722,-13.89188 -9.8639,-10.47247 -13.9159,-21.29364 -39.505,-30.82259 l -50.7323,-12.50826 c -57.4168,-27.2645 -114.5796,-54.78314 -161.9103,-92.13375 21.8245,-18.11121 41.555,-50.79169 57.044,-80.15004 12.8789,-40.66267 27.5888,-70.63422 38.8996,-125.79988 1.0364,-12.41879 4.7554,-30.1288 -7.3596,-45.82146 z"
          presences={mergedPresences[8]}
          canAddPresence={!landDistances || landDistances[8] <= MAX_DISTANCE}
          onLandAddPresence={onLandAddPresence}
        />
        <Land
          landNumber={7}
          fill="#d5b615"
          d="m 1053.4854,1047.991 c 51.0102,5.7457 99.2611,2.5756 144.6602,0.4657 28.8424,-46.9616 45.5344,-110.62823 82.5775,-142.82863 19.7509,-25.89104 56.6164,-0.99172 71.1514,3.57637 78.7112,-37.1699 125.1199,-60.85087 143.7461,-123.97191 -7.4645,-13.12197 -20.6791,-19.39871 -20.2968,-41.86215 0.258,-22.30844 7.0464,-44.37898 19.824,-67.89053 35.9547,-53.26737 89.8576,-93.45879 106.5166,-166.53078 -34.1503,7.31047 -59.1327,-7.47029 -63.8102,-20.07172 -11.2347,-9.00067 -15.9752,-17.18906 -28.1015,-21.79928 -20.3546,-6.46046 -40.7784,-11.15518 -57.9315,-15.1708 -33.6726,17.52669 -63.6144,42.14178 -94.1644,65.60132 -40.2067,37.7274 -66.1233,67.41657 -98.2917,100.62239 -3.3921,23.43778 -8.7861,49.76067 -14.2831,75.13167 -5.3444,20.6236 -13.1361,40.83931 -22.4002,60.80961 -14.1366,21.55264 -32.5451,39.61008 -50.0898,58.37424 -20.5262,28.68264 -40.4764,54.01411 -64.4506,89.04385 -16.7194,19.53193 -28.1797,43.55275 -36.3363,66.57794 -11.3118,30.96979 -12.7447,54.26311 -18.3197,79.92271 z"
          presences={mergedPresences[7]}
          canAddPresence={!landDistances || landDistances[7] <= MAX_DISTANCE}
          onLandAddPresence={onLandAddPresence}
        />
      </g>
    </svg>
  );
};

const boardA: Board = {
  variation: 'A',
  lands,
  MapComponent,
};

export default boardA;
